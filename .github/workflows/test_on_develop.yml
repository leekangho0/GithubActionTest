# This workflow will build a Swift project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-swift

# workflow ì˜ ì´ë¦„
name: Run Test

on:
  # develop ë¸Œëœì¹˜ì— push ë‚˜ pull request ì´ë²¤íŠ¸ê°€ ì¼ì–´ë‚¬ì„ë•Œ í•´ë‹¹ workflow ë¥¼ trigger
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

# workflowì˜ ì‹¤í–‰ì€ í•˜ë‚˜ ì´ìƒì˜ jobìœ¼ë¡œ êµ¬ì„± ë¨
jobs:
  # ì´ workflow ëŠ” "build" ë¼ëŠ” single job ìœ¼ë¡œ êµ¬ì„±
  build:
    # jobì´ ì‹¤í–‰ë  í™˜ê²½ - ìµœì‹  mac os
    runs-on: macos-15.6

    # Stepì€ jobì˜ ì¼ë¶€ë¡œ ì‹¤í–‰ë  ì¼ë ¨ì˜ taskë“¤ì„ ë‚˜íƒ€ëƒ„
    steps:
    # 1ï¸âƒ£ ë©”ì¸ í”„ë¡œì íŠ¸ (ê³µê°œ ë ˆí¬) ì²´í¬ì•„ì›ƒ
    - name: Checkout main repository
      uses: actions/checkout@v4

    # 2ï¸âƒ£ ë¹„ê³µê°œ Secrets ë ˆí¬ ì²´í¬ì•„ì›ƒ
    - name: Checkout secrets repository
      uses: actions/checkout@v3
      with:
        repository: ESTiOSAI/Secrets   # ğŸ‘ˆ Secrets repo ì´ë¦„ ë³€ê²½
        path: SecretsRepo              # ë ˆí¬ ë³µì‚¬
        token: ${{ secrets.ACTION_TOKEN }} # ğŸ‘ˆ Deploy key ë˜ëŠ” Personal Access Token

    # 3ï¸âƒ£ Secrets íŒŒì¼ ë³µì‚¬
    - name: Copy Secrets files
      run: |
        cp SecretsRepo/XCConfig/Secrets.xcconfig ./iCo/AIProject/App/Resource/
        cp SecretsRepo/GoogleServices/GoogleService-Info.plist ./iCo/AIProject/App/Resource/
    
    # uses í‚¤ì›Œë“œë¥¼ í†µí•´ Github Actionsì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” ì•¡ì…˜ì„ ì‚¬ìš© ê°€ëŠ¥. ì•„ë˜ ì•¡ì…˜ì€ repository ì— ì²´í¬ì•„ì›ƒí•˜ëŠ” ê²ƒ
    # shell ì´ìš©í•´ì„œ í•˜ë‚˜ì˜ command ìˆ˜í–‰
    - name: Start xcode build ğŸ› 
      run: |
        xcodebuild clean test -project GithubActionTest.xcodeproj -scheme GithubActionTest -destination 'platform=iOS Simulator,name=iPhone 16 Pro,OS=18.6'

